{"version":3,"sources":["assets\\script\\comp\\wxRankList.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["let Consts = {\r\n\tOpenDataKeys: {\r\n\t\tInitKey: \"initKey\",\r\n\t\tGrade: \"testkey\",\r\n\t\tLevelKey: \"reachlevel\",\r\n\t\tScoreKey: \"levelScore\", // json.string\r\n\t},\r\n\tDomainAction: {\r\n\t\tFetchFriend: \"FetchFriend\",\r\n\t\tFetchGroup: \"FetchGroup\",\r\n\t\tFetchFriendLevel: \"FetchFriendLevel\", //好友关卡进度排行\r\n\t\tFetchFriendScore: \"FetchFriendScore\", //好友关卡得分排行\r\n\t\tHorConmpar: \"HorConmpar\", //横向比较 horizontal comparison\r\n\t\tPaging: \"Paging\",\r\n        Scrolling: \"Scrolling\",\r\n        SumbitScore: \"SumbitScore\",//提交分数\r\n\t\tShowRank: \"ShowRank\"//显示排名\r\n\t},\r\n}\r\n\r\nwindow.Platform={};\r\nPlatform.CC_WECHATGAME=cc.sys.platform === cc.sys.WECHAT_GAME//在微信平台\r\n\r\n// 这个换成自己的逻辑\r\nlet utils = {\r\n    curLevel : 1,\r\n    getScore : _=>{return 1}\r\n}\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class wxRankList extends cc.Component {\r\n    \r\n    @property(cc.Sprite)\r\n    rankRender:cc.Sprite=null; // render spr\r\n    @property(cc.Node)\r\n    rankListNode:cc.Node=null;\r\n\r\n    @property(cc.Node)\r\n    rankBgNode:cc.Node=null;\r\n\r\n    @property(cc.Label)\r\n    labelTitle:cc.Label=null;\r\n    @property(cc.Node)\r\n    touchLayer:cc.Node=null;\r\n\r\n    // @property(Boolean)\r\n    enableScroll = true;//\r\n\r\n    _timeCounter=0;\r\n    rendInterval=0.5;//刷新排行画布间隔s\r\n\r\n    rankTexture:cc.Texture2D=null;\r\n    rankSpriteFrame : cc.SpriteFrame=null;\r\n    closeBackRank=0; // 关闭后操作\r\n\r\n    onLoad() {        \r\n        this._timeCounter = 0\r\n        this.rankTexture = new cc.Texture2D();\r\n        this.rankSpriteFrame = new cc.SpriteFrame();\r\n        this.resizeSharedCanvas(this.rankRender.node.width, this.rankRender.node.height)\r\n    }\r\n    update(dt) {\r\n        this.updateRankList()\r\n    }\r\n\r\n    resizeSharedCanvas(width, height){\r\n        if(Platform.CC_WECHATGAME){\r\n            let sharedCanvas = window[\"wx\"].getOpenDataContext().canvas\r\n            sharedCanvas.width = width\r\n            sharedCanvas.height = height\r\n            console.log(sharedCanvas)\r\n        }\r\n    }\r\n\r\n    changeRender(renderNode:cc.Node){\r\n        this.rankListNode.active = true;\r\n        this.rankBgNode.active = true;\r\n\r\n        this.rankRender.node.width = renderNode.width\r\n        this.rankRender.node.height = renderNode.height\r\n        this.rankRender.node.position = renderNode.position\r\n        this.resizeSharedCanvas(renderNode.width, renderNode.height)\r\n    }\r\n\r\n    updateRankList() {\r\n        if(Platform.CC_WECHATGAME){\r\n            if(!this.rankTexture) return;\r\n            let sharedCanvas = window[\"wx\"].getOpenDataContext().canvas\r\n            this.rankTexture.initWithElement(sharedCanvas);\r\n            this.rankTexture.handleLoadedTexture();\r\n            this.rankSpriteFrame.setTexture(this.rankTexture);\r\n            this.rankRender.spriteFrame = this.rankSpriteFrame;\r\n        }\r\n    }\r\n\r\n    onEnable() {\r\n        this.touchLayer.active = true\r\n        if (this.enableScroll) {\r\n            this.rankRender.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this)\r\n        }\r\n    }\r\n\r\n    onDisable() {\r\n        if (this.enableScroll) {\r\n            this.rankRender.node.off(cc.Node.EventType.TOUCH_MOVE)\r\n        }\r\n    }\r\n\r\n    onClose() {\r\n        this.node.active = false;\r\n        this.node.emit(Const.CLOSE);\r\n    }\r\n\r\n    onTouchMove(event) {\r\n        const deltaY = event.getDeltaY();\r\n        // console.log(\"rank touchmove:\", deltaY);\r\n        this.postMessage(\"Scrolling\", deltaY)\r\n    }    \r\n\r\n    //向子域发送消息\r\n    postMessage(action, data=null, dataEx=null) {\r\n        if(Platform.CC_WECHATGAME){\r\n            let openDataContext = window.wx.getOpenDataContext()\r\n            openDataContext.postMessage({\r\n                action: action,\r\n                data: data,\r\n                dataEx:dataEx,\r\n            })\r\n        }\r\n    }\r\n\r\n    //获取关卡得分排行\r\n    showRank(level,gameName,isMax=true){\r\n        this.labelTitle.string = gameName+`排行榜`\r\n        this.node.active = true;\r\n        this.touchLayer.active = true\r\n        this.onEnable()\r\n        this.changeRender(this.rankListNode)        \r\n        this.postMessage(Consts.DomainAction.ShowRank, {level:level,isMax:isMax})\r\n    }\r\n    //提交分数\r\n    sumbitScore(level,score,isMax=true) {\r\n        cc.log(level,score,isMax);\r\n        if(Platform.CC_WECHATGAME){\r\n            this.postMessage(Consts.DomainAction.SumbitScore, {level:level,score:score,isMax:isMax});\r\n        }\r\n    }\r\n}\r\n"]}